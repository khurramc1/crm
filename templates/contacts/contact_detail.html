{% extends 'base.html' %}

{% block title %}Contact - CRM{% endblock %}

{% block header %}Contact: {{ contact.full_name }}{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
        <!-- Contact Details -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="flex justify-between items-start mb-6">
                <h2 class="text-2xl font-bold">{{ contact.full_name }}</h2>
                <a href="{% url 'contacts:contact_update' contact.id %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Edit
                </a>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <p class="text-sm text-gray-500">Email</p>
                    <p class="font-medium"><a href="mailto:{{ contact.email }}" class="text-blue-600">{{ contact.email }}</a></p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Phone</p>
                    <p class="font-medium">{{ contact.phone|default:"-" }}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Status</p>
                    <p class="font-medium">
                        <span class="px-2 py-1 rounded text-xs font-semibold {% if contact.status == 'lead' %}bg-yellow-100 text-yellow-800{% elif contact.status == 'prospect' %}bg-blue-100 text-blue-800{% elif contact.status == 'customer' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ contact.get_status_display }}
                        </span>
                    </p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Company</p>
                    <p class="font-medium">
                        {% if contact.company %}
                            <a href="{% url 'contacts:company_detail' contact.company.id %}" class="text-blue-600">
                                {{ contact.company.name }}
                            </a>
                        {% else %}
                            -
                        {% endif %}
                    </p>
                </div>
            </div>

            {% if contact.notes %}
                <div>
                    <p class="text-sm text-gray-500 mb-2">Notes</p>
                    <p class="text-gray-700">{{ contact.notes }}</p>
                </div>
            {% endif %}
        </div>

        <!-- Activity Timeline -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Activity Timeline</h3>
                <a href="{% url 'contacts:activity_create' contact.id %}" class="text-blue-600 hover:underline text-sm">Add Activity</a>
            </div>

            <div class="space-y-4">
                {% for activity in activities %}
                    <div class="flex items-start pb-4 border-b last:border-b-0">
                        <div class="flex-shrink-0 w-3 h-3 mt-2 rounded-full bg-blue-500"></div>
                        <div class="ml-4 flex-1">
                            <p class="font-medium">{{ activity.title }}</p>
                            <p class="text-sm text-gray-600">{{ activity.description }}</p>
                            <p class="text-xs text-gray-500 mt-1">{{ activity.activity_type|title }} - {{ activity.created_at|date:"M d, Y H:i" }}</p>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-gray-500">No activities yet</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <div>
        <!-- Quick Actions -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="font-semibold mb-4">Quick Actions</h3>
            <div class="space-y-2">
                <a href="{% url 'deals:deal_create' %}" class="block px-4 py-2 bg-blue-600 text-white rounded text-center hover:bg-blue-700 text-sm">
                    New Deal
                </a>
                <a href="{% url 'emails:campaign_create' %}" class="block px-4 py-2 bg-purple-600 text-white rounded text-center hover:bg-purple-700 text-sm">
                    Create Campaign
                </a>
                <a href="{% url 'automations:workflow_create' %}" class="block px-4 py-2 bg-orange-600 text-white rounded text-center hover:bg-orange-700 text-sm">
                    New Workflow
                </a>
            </div>
        </div>

        <!-- Associated Deals -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="font-semibold mb-4">Associated Deals</h3>
            {% if deals %}
                <ul class="space-y-2">
                    {% for deal in deals %}
                        <li>
                            <a href="{% url 'deals:deal_detail' deal.id %}" class="text-blue-600 hover:underline text-sm">
                                {{ deal.title }}
                            </a>
                            <p class="text-xs text-gray-600">{{ deal.get_status_display }}</p>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-gray-500 text-sm">No deals yet</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
